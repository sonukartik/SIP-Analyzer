{% extends "base.html" %}

{% block title %}SIP, Lumpsum, FD & RD Calculator with Tax Planning{% endblock %}

{% block head_style %}
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* Re-add flex properties from base.html to keep footer at bottom */
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            background: white;
            border-bottom: 1px solid #e1e5f2;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 20px 25px;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.4s ease;
            border-radius: 8px 8px 0 0;
            border-bottom: 4px solid transparent;
        }

        .tab-btn:hover {
            color: #667eea;
            background-color: #e9eafc;
        }

        .tab-btn.active {
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            border-bottom-color: #764ba2;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
            padding: 40px;
        }

        .form-section {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e1e5f2;
        }

        .calculator-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 5px;
            background: #e1e5f2;
            border-radius: 8px;
        }

        .calc-type-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
            font-size: 14px;
        }

        .calc-type-btn:hover:not(.active) {
            background: linear-gradient(135deg, #a8b2f0, #b194cf);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: white;
            transform: scale(1.05);
        }

        .calc-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.6);
            transform: scale(1.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5f2;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .advanced-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e1e5f2;
        }

        .advanced-toggle {
            background: none;
            border: none;
            color: #667eea;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .advanced-toggle:hover {
            color: #764ba2;
            text-shadow: 0 0 8px rgba(102, 126, 234, 0.7);
        }

        .advanced-options {
            display: none;
        }

        .advanced-options.show {
            display: block;
        }

        .tax-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #856404;
        }

        .fd-info, .rd-info {
            background: #d1ecf1;
            border: 1px solid #b6d4db;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #0c5460;
        }

        .rd-info {
            background: #e8d5f2;
            border: 1px solid #d1a7e1;
            color: #4a1a5c;
        }

        .swp-info {
            background: #fce4ec;
            border: 1px solid #f8bbd9;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            color: #880e4f;
        }

        .tax-info strong, .fd-info strong, .rd-info strong, .swp-info strong {
            color: #6c5214;
        }

        .rd-info strong {
            color: #4a1a5c;
        }

        .swp-info strong {
            color: #880e4f;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .results-section {
            background: #f8f9ff;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e1e5f2;
        }

        .results-grid {
            display: grid;
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-item.highlight {
            border-left-color: #2ecc71;
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
        }

        .result-item.tax {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
        }

        .result-item.fd-specific {
            border-left-color: #17a2b8;
            background: linear-gradient(135deg, #e1f7fa 0%, #b6d4db 100%);
        }

        .result-item.rd-specific {
            border-left-color: #9b59b6;
            background: linear-gradient(135deg, #f3e8ff 0%, #e8d5f2 100%);
        }

        .result-item.swp-specific {
            border-left-color: #e91e63;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
        }

        .result-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .chart-container {
            text-align: center;
            margin-top: 30px;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .no-results {
            text-align: center;
            color: #666;
            font-size: 18px;
            padding: 40px;
        }

        .calculator-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-section, .results-section {
                padding: 20px;
            }

            .tab-btn {
                padding: 15px 10px;
                font-size: 14px;
            }

            .calculator-type-selector {
                flex-direction: column;
            }

            .calc-type-btn {
                font-size: 12px;
                padding: 10px;
            }
        }

        .arrow {
            transition: transform 0.3s ease;
        }

        .arrow.rotated {
            transform: rotate(180deg);
        }

        /* Simple calculator specific styles */
        .simple-results .result-item {
            margin-bottom: 15px;
        }

        .simple-results .result-value {
            font-size: 28px;
        }

        .simple-calc-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 5px;
            background: #e1e5f2;
            border-radius: 8px;
        }

        .simple-calc-type-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
            font-size: 14px;
        }

        .simple-calc-type-btn:hover:not(.active) {
            background: linear-gradient(135deg, #a8b2f0, #b194cf);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            color: white;
            transform: scale(1.05);
        }

        .simple-calc-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.6);
            transform: scale(1.05);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
        <div class="header">
            <h1>Investment Calculator</h1>
            <p>Plan your SIP, Lumpsum & Fixed Deposit investments with tax considerations</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn {% if active_tab == 'simple' %}active{% endif %}" onclick="switchTab('simple')">Simple Calculator</button>
            <button class="tab-btn {% if active_tab == 'advanced' %}active{% endif %}" onclick="switchTab('advanced')">Advanced Calculator</button>
            <button class="tab-btn {% if active_tab == 'fd' %}active{% endif %}" onclick="switchTab('fd')">FD Calculator</button>
            <button class="tab-btn {% if active_tab == 'rd' %}active{% endif %}" onclick="switchTab('rd')">RD Calculator</button>
            <button class="tab-btn {% if active_tab == 'swp' %}active{% endif %}" onclick="switchTab('swp')">SWP Calculator</button>
        </div>

        <!-- Simple Calculator Tab -->
        <div class="tab-content {% if active_tab == 'simple' %}active{% endif %}" id="simple-tab">
            <div class="content">
                <div class="form-section">
                    <h2>Simple Investment Calculator</h2>
                    
                    <!-- Simple calculator type selector -->
                    <div class="simple-calc-type-selector">
                        <button type="button" class="simple-calc-type-btn active" onclick="switchSimpleCalc('sip')">
                            <span class="calculator-icon">ðŸ“ˆ</span>SIP
                        </button>
                        <button type="button" class="simple-calc-type-btn" onclick="switchSimpleCalc('lumpsum')">
                            <span class="calculator-icon">ðŸ’°</span>Lumpsum
                        </button>
                    </div>

                    <form method="post" id="simple-form">
                        <input type="hidden" name="form_type" value="simple">
                        <input type="hidden" name="calculator_type" value="sip" id="simple-calc-type">

                        <!-- SIP Fields -->
                        <div id="simple-sip-fields">
                            <div class="form-group">
                                <label for="simple_monthly_sip">Monthly SIP Amount (â‚¹)</label>
                                <input type="number" id="simple_monthly_sip" name="monthly_sip" 
                                       value="{{ form_data.get('monthly_sip', 5000) }}" min="100" step="100" required>
                            </div>
                        </div>

                        <!-- Lumpsum Fields -->
                        <div id="simple-lumpsum-fields" style="display: none;">
                            <div class="form-group">
                                <label for="simple_lumpsum_amount">Investment Amount (â‚¹)</label>
                                <input type="number" id="simple_lumpsum_amount" name="lumpsum_amount" 
                                       value="{{ form_data.get('lumpsum_amount', 100000) }}" min="1000" step="1000">
                            </div>
                        </div>

                        <!-- Common Fields -->
                        <div class="form-group">
                            <label for="simple_annual_return">Expected Annual Return (%)</label>
                            <input type="number" id="simple_annual_return" name="annual_return" 
                                   value="{{ (form_data.get('annual_return', 0.12) * 100) | round(1) }}" 
                                   min="1" max="30" step="0.1" required>
                        </div>

                        <div class="form-group">
                            <label for="simple_years">Investment Duration (Years)</label>
                            <input type="number" id="simple_years" name="years" 
                                   value="{{ form_data.get('years', 10) }}" min="1" max="50" required>
                        </div>

                        <div class="form-group">
                            <label for="simple_expense_ratio">Expense Ratio (%)</label>
                            <input type="number" id="simple_expense_ratio" name="expense_ratio" 
                                   value="{{ (form_data.get('expense_ratio', 0.01) * 100) | round(2) }}" 
                                   min="0" max="5" step="0.01">
                        </div>

                        <!-- Hidden fields with default values -->
                        <input type="hidden" name="inflation_rate" value="6">
                        <input type="hidden" name="ltcg_rate" value="10">
                        <input type="hidden" name="stcg_rate" value="15">

                        <button type="submit" class="calculate-btn">Calculate Returns</button>
                    </form>
                </div>

                <div class="results-section">
                    <h2>Results</h2>
                    {% if result and active_tab == 'simple' %}
                        <div class="simple-results">
                            <div class="result-item">
                                <div class="result-label">Total Invested</div>
                                <div class="result-value">â‚¹{{ result.total_invested | with_unit }}</div>
                            </div>
                            <div class="result-item highlight">
                                <div class="result-label">Final Corpus</div>
                                <div class="result-value">â‚¹{{ result.final_corpus | with_unit }}</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">Capital Gains</div>
                                <div class="result-value">â‚¹{{ result.capital_gains | with_unit }}</div>
                            </div>
                            <div class="result-item tax">
                                <div class="result-label">{{ result.tax_type }} Tax</div>
                                <div class="result-value">â‚¹{{ result.capital_gains_tax | with_unit }}</div>
                            </div>
                        </div>

                        {% if chart %}
                        <div class="chart-container">
                            <img src="data:image/png;base64,{{ chart }}" alt="Investment Breakdown Chart">
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-results">
                            <p>Enter your investment details and click "Calculate Returns" to see the results.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Advanced Calculator Tab -->
        <div class="tab-content {% if active_tab == 'advanced' %}active{% endif %}" id="advanced-tab">
            <div class="content">
                <div class="form-section">
                    <h2>Advanced Investment Calculator</h2>
                    
                    <!-- Calculator type selector -->
                    <div class="calculator-type-selector">
                        <button type="button" class="calc-type-btn {% if calculator_type == 'sip' %}active{% endif %}" onclick="switchCalculator('sip')">
                            <span class="calculator-icon">ðŸ“ˆ</span>SIP
                        </button>
                        <button type="button" class="calc-type-btn {% if calculator_type == 'lumpsum' %}active{% endif %}" onclick="switchCalculator('lumpsum')">
                            <span class="calculator-icon">ðŸ’°</span>Lumpsum
                        </button>
                    </div>

                    <form method="post" id="advanced-form">
                        <input type="hidden" name="form_type" value="advanced">
                        <input type="hidden" name="calculator_type" value="{{ calculator_type }}" id="calc-type">

                        <!-- SIP specific fields -->
                        <div id="sip-fields" {% if calculator_type != 'sip' %}style="display: none;"{% endif %}>
                            <div class="form-group">
                                <label for="monthly_sip">Monthly SIP Amount (â‚¹)</label>
                                <input type="number" id="monthly_sip" name="monthly_sip" 
                                       value="{{ form_data.get('monthly_sip', 5000) }}" min="100" step="100" required>
                            </div>
                        </div>

                        <!-- Lumpsum specific fields -->
                        <div id="lumpsum-fields" {% if calculator_type != 'lumpsum' %}style="display: none;"{% endif %}>
                            <div class="form-group">
                                <label for="lumpsum_amount">Investment Amount (â‚¹)</label>
                                <input type="number" id="lumpsum_amount" name="lumpsum_amount" 
                                       value="{{ form_data.get('lumpsum_amount', 100000) }}" min="1000" step="1000">
                            </div>
                        </div>

                        <!-- Common fields -->
                        <div class="form-group">
                            <label for="annual_return">Expected Annual Return (%)</label>
                            <input type="number" id="annual_return" name="annual_return" 
                                   value="{{ (form_data.get('annual_return', 0.12) * 100) | round(1) }}" 
                                   min="1" max="30" step="0.1" required>
                        </div>

                        <div class="form-group">
                            <label for="expense_ratio">Expense Ratio (%)</label>
                            <input type="number" id="expense_ratio" name="expense_ratio" 
                                   value="{{ (form_data.get('expense_ratio', 0.01) * 100) | round(2) }}" 
                                   min="0" max="5" step="0.01" required>
                        </div>

                        <div class="form-group">
                            <label for="years">Investment Duration (Years)</label>
                            <input type="number" id="years" name="years" 
                                   value="{{ form_data.get('years', 10) }}" min="1" max="50" required>
                        </div>

                        <!-- Advanced options -->
                        <div class="advanced-section">
                            <button type="button" class="advanced-toggle" onclick="toggleAdvanced()">
                                <span>Advanced Options</span>
                                <span class="arrow" id="advanced-arrow">â–¼</span>
                            </button>
                            
                            <div class="advanced-options" id="advanced-options">
                                <div class="tax-info">
                                    <strong>Tax Information:</strong><br>
                                    LTCG (Long Term Capital Gains) applies after 1 year. First â‚¹1 Lakh is tax-free.<br>
                                    STCG (Short Term Capital Gains) applies for investments â‰¤ 1 year.
                                </div>

                                <div class="form-group">
                                    <label for="inflation_rate">Inflation Rate (%)</label>
                                    <input type="number" id="inflation_rate" name="inflation_rate" 
                                           value="{{ (form_data.get('inflation_rate', 0.06) * 100) | round(1) }}" 
                                           min="0" max="20" step="0.1">
                                </div>

                                <div class="form-group">
                                    <label for="ltcg_rate">LTCG Tax Rate (%)</label>
                                    <input type="number" id="ltcg_rate" name="ltcg_rate" 
                                           value="{{ (form_data.get('ltcg_rate', 0.10) * 100) | round(1) }}" 
                                           min="0" max="50" step="0.1">
                                </div>

                                <div class="form-group">
                                    <label for="stcg_rate">STCG Tax Rate (%)</label>
                                    <input type="number" id="stcg_rate" name="stcg_rate" 
                                           value="{{ (form_data.get('stcg_rate', 0.15) * 100) | round(1) }}" 
                                           min="0" max="50" step="0.1">
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="calculate-btn">Calculate Returns</button>
                    </form>
                </div>

                <div class="results-section">
                    <h2>Investment Analysis</h2>
                    {% if result and active_tab == 'advanced' %}
                        <div class="results-grid">
                            <div class="result-item">
                                <div class="result-label">Total Invested</div>
                                <div class="result-value">â‚¹{{ result.total_invested | with_unit }}</div>
                            </div>

                            <div class="result-item">
                                <div class="result-label">Gross Corpus (Before Tax)</div>
                                <div class="result-value">â‚¹{{ result.gross_corpus | with_unit }}</div>
                            </div>

                            <div class="result-item highlight">
                                <div class="result-label">Final Corpus</div>
                                <div class="result-value">â‚¹{{ result.final_corpus | with_unit }}</div>
                            </div>

                            <div class="result-item">
                                <div class="result-label">Capital Gains</div>
                                <div class="result-value">â‚¹{{ result.capital_gains | with_unit }}</div>
                            </div>

                            <div class="result-item tax">
                                <div class="result-label">{{ result.tax_type }} Tax</div>
                                <div class="result-value">â‚¹{{ result.capital_gains_tax | with_unit }}</div>
                            </div>

                            <div class="result-item">
                                <div class="result-label">Fees Paid</div>
                                <div class="result-value">â‚¹{{ result.fees_paid | with_unit }}</div>
                            </div>

                            <div class="result-item">
                                <div class="result-label">Net Returns</div>
                                <div class="result-value">â‚¹{{ result.net_return | with_unit }}</div>
                            </div>

                            <div class="result-item">
                                <div class="result-label">Inflation Adjusted Corpus</div>
                                <div class="result-value">â‚¹{{ result.inflation_adjusted_final_corpus | with_unit }}</div>
                            </div>
                        </div>

                        {% if chart %}
                        <div class="chart-container">
                            <img src="data:image/png;base64,{{ chart }}" alt="Investment Breakdown Chart">
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-results">
                            <p>Enter your investment details and click "Calculate Returns" to see detailed analysis.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- FD Calculator Tab -->
        <div class="tab-content {% if active_tab == 'fd' %}active{% endif %}" id="fd-tab">
            <div class="content">
                <div class="form-section">
                    <h2>Fixed Deposit Calculator</h2>
                    
                    <div class="fd-info">
                        <strong>Fixed Deposit Information:</strong><br>
                        Calculate returns on your Fixed Deposit investments with compound interest.
                    </div>

                    <form method="post" id="fd-form">
                        <input type="hidden" name="form_type" value="fd">

                        <div class="form-group">
                            <label for="fd_principal_amount">Principal Amount (â‚¹)</label>
                            <input type="number" id="fd_principal_amount" name="fd_principal_amount" 
                                   value="{{ form_data.get('principal_amount', 100000) }}" min="1000" step="1000" required>
                        </div>

                        <div class="form-group">
                            <label for="fd_annual_interest_rate">Annual Interest Rate (%)</label>
                            <input type="number" id="fd_annual_interest_rate" name="fd_annual_interest_rate" 
                                   value="{{ (form_data.get('annual_interest_rate', 0.07) * 100) | round(2) }}" 
                                   min="1" max="15" step="0.01" required>
                        </div>

                        <div class="form-group">
                            <label for="fd_years">Investment Duration (Years)</label>
                            <input type="number" id="fd_years" name="fd_years" 
                                   value="{{ form_data.get('years', 5) }}" min="1" max="20" required>
                        </div>

                        <div class="form-group">
                            <label for="fd_compounding_frequency">Compounding Frequency</label>
                            <select id="fd_compounding_frequency" name="fd_compounding_frequency" required>
                                <option value="yearly" {% if form_data.get('compounding_frequency') == 'yearly' %}selected{% endif %}>Yearly</option>
                                <option value="half-yearly" {% if form_data.get('compounding_frequency') == 'half-yearly' %}selected{% endif %}>Half-Yearly</option>
                                <option value="quarterly" {% if form_data.get('compounding_frequency') == 'quarterly' or not form_data.get('compounding_frequency') %}selected{% endif %}>Quarterly</option>
                                <option value="monthly" {% if form_data.get('compounding_frequency') == 'monthly' %}selected{% endif %}>Monthly</option>
                                <option value="daily" {% if form_data.get('compounding_frequency') == 'daily' %}selected{% endif %}>Daily</option>
                            </select>
                        </div>

                        <button type="submit" class="calculate-btn">Calculate FD Returns</button>
                    </form>
                </div>

                <div class="results-section">
                    <h2>FD Analysis</h2>
                    {% if result and calculator_type == 'fd' %}
                        <div class="results-grid">
                            <div class="result-item fd-specific">
                                <div class="result-label">Principal Amount</div>
                                <div class="result-value">â‚¹{{ result.principal_amount | with_unit }}</div>
                            </div>

                            <div class="result-item fd-specific highlight">
                                <div class="result-label">Maturity Amount</div>
                                <div class="result-value">â‚¹{{ result.maturity_amount | with_unit }}</div>
                            </div>

                            <div class="result-item fd-specific">
                                <div class="result-label">Interest Earned</div>
                                <div class="result-value">â‚¹{{ result.interest_earned | with_unit }}</div>
                            </div>

                            <div class="result-item fd-specific">
                                <div class="result-label">Effective Annual Rate</div>
                                <div class="result-value">{{ result.effective_rate }}%</div>
                            </div>
                        </div>

                        {% if chart %}
                        <div class="chart-container">
                            <img src="data:image/png;base64,{{ chart }}" alt="FD Breakdown Chart">
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-results">
                            <p>Enter your FD details and click "Calculate FD Returns" to see the analysis.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- RD Calculator Tab -->
        <div class="tab-content {% if active_tab == 'rd' %}active{% endif %}" id="rd-tab">
            <div class="content">
                <div class="form-section">
                    <h2>Recurring Deposit Calculator</h2>
                    
                    <div class="rd-info">
                        <strong>Recurring Deposit Information:</strong><br>
                        Calculate returns on your monthly RD investments with compound interest.
                    </div>

                    <form method="post" id="rd-form">
                        <input type="hidden" name="form_type" value="rd">

                        <div class="form-group">
                            <label for="rd_monthly_deposit">Monthly Deposit Amount (â‚¹)</label>
                            <input type="number" id="rd_monthly_deposit" name="rd_monthly_deposit" 
                                   value="{{ form_data.get('monthly_deposit', 5000) }}" min="100" step="100" required>
                        </div>

                        <div class="form-group">
                            <label for="rd_annual_interest_rate">Annual Interest Rate (%)</label>
                            <input type="number" id="rd_annual_interest_rate" name="rd_annual_interest_rate" 
                                   value="{{ (form_data.get('annual_interest_rate', 0.07) * 100) | round(2) }}" 
                                   min="1" max="15" step="0.01" required>
                        </div>

                        <div class="form-group">
                            <label for="rd_years">Investment Duration (Years)</label>
                            <input type="number" id="rd_years" name="rd_years" 
                                   value="{{ form_data.get('years', 5) }}" min="1" max="20" required>
                        </div>

                        <div class="form-group">
                            <label for="rd_compounding_frequency">Compounding Frequency</label>
                            <select id="rd_compounding_frequency" name="rd_compounding_frequency" required>
                                <option value="yearly" {% if form_data.get('compounding_frequency') == 'yearly' %}selected{% endif %}>Yearly</option>
                                <option value="half-yearly" {% if form_data.get('compounding_frequency') == 'half-yearly' %}selected{% endif %}>Half-Yearly</option>
                                <option value="quarterly" {% if form_data.get('compounding_frequency') == 'quarterly' or not form_data.get('compounding_frequency') %}selected{% endif %}>Quarterly</option>
                                <option value="monthly" {% if form_data.get('compounding_frequency') == 'monthly' %}selected{% endif %}>Monthly</option>
                                <option value="daily" {% if form_data.get('compounding_frequency') == 'daily' %}selected{% endif %}>Daily</option>
                            </select>
                        </div>

                        <button type="submit" class="calculate-btn">Calculate RD Returns</button>
                    </form>
                </div>

                <div class="results-section">
                    <h2>RD Analysis</h2>
                    {% if result and calculator_type == 'rd' %}
                        <div class="results-grid">
                            <div class="result-item rd-specific">
                                <div class="result-label">Monthly Deposit</div>
                                <div class="result-value">â‚¹{{ result.monthly_deposit | with_unit }}</div>
                            </div>

                            <div class="result-item rd-specific">
                                <div class="result-label">Total Invested</div>
                                <div class="result-value">â‚¹{{ result.total_invested | with_unit }}</div>
                            </div>

                            <div class="result-item rd-specific highlight">
                                <div class="result-label">Maturity Amount</div>
                                <div class="result-value">â‚¹{{ result.maturity_amount | with_unit }}</div>
                            </div>

                            <div class="result-item rd-specific">
                                <div class="result-label">Interest Earned</div>
                                <div class="result-value">â‚¹{{ result.interest_earned | with_unit }}</div>
                            </div>

                            <div class="result-item rd-specific">
                                <div class="result-label">Effective Annual Rate</div>
                                <div class="result-value">{{ result.effective_rate }}%</div>
                            </div>
                        </div>

                        {% if chart %}
                        <div class="chart-container">
                            <img src="data:image/png;base64,{{ chart }}" alt="RD Breakdown Chart">
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-results">
                            <p>Enter your RD details and click "Calculate RD Returns" to see the analysis.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- SWP Calculator Tab -->
        <div class="tab-content {% if active_tab == 'swp' %}active{% endif %}" id="swp-tab">
            <div class="content">
                <div class="form-section">
                    <h2>SWP Calculator</h2>
                    
                    <div class="swp-info">
                        <strong>Systematic Withdrawal Plan (SWP) Information:</strong><br>
                        Calculate how long your corpus will last with regular monthly withdrawals.
                    </div>

                    <form method="post" id="swp-form">
                        <input type="hidden" name="form_type" value="swp">

                        <div class="form-group">
                            <label for="swp_initial_corpus">Initial Corpus (â‚¹)</label>
                            <input type="number" id="swp_initial_corpus" name="swp_initial_corpus" 
                                   value="{{ form_data.get('initial_corpus', 1000000) }}" min="10000" step="10000" required>
                        </div>

                        <div class="form-group">
                            <label for="swp_monthly_withdrawal">Monthly Withdrawal (â‚¹)</label>
                            <input type="number" id="swp_monthly_withdrawal" name="swp_monthly_withdrawal" 
                                   value="{{ form_data.get('monthly_withdrawal', 10000) }}" min="100" step="100" required>
                        </div>

                        <div class="form-group">
                            <label for="swp_annual_return">Expected Annual Return (%)</label>
                            <input type="number" id="swp_annual_return" name="swp_annual_return" 
                                   value="{{ (form_data.get('annual_return', 0.12) * 100) | round(1) }}" 
                                   min="1" max="30" step="0.1" required>
                        </div>

                        <div class="form-group">
                            <label for="swp_expense_ratio">Expense Ratio (%)</label>
                            <input type="number" id="swp_expense_ratio" name="swp_expense_ratio" 
                                   value="{{ (form_data.get('expense_ratio', 0.01) * 100) | round(2) }}" 
                                   min="0" max="5" step="0.01">
                        </div>

                        <div class="form-group">
                            <label for="swp_inflation_rate">Inflation Rate (%)</label>
                            <input type="number" id="swp_inflation_rate" name="swp_inflation_rate" 
                                   value="{{ (form_data.get('inflation_rate', 0.06) * 100) | round(1) }}" 
                                   min="0" max="20" step="0.1">
                        </div>

                        <button type="submit" class="calculate-btn">Calculate SWP</button>
                    </form>
                </div>

                <div class="results-section">
                    <h2>SWP Analysis</h2>
                    {% if result and calculator_type == 'swp' %}
                        <div class="results-grid">
                            <div class="result-item swp-specific">
                                <div class="result-label">Initial Corpus</div>
                                <div class="result-value">â‚¹{{ result.initial_corpus | with_unit }}</div>
                            </div>

                            <div class="result-item swp-specific">
                                <div class="result-label">Monthly Withdrawal</div>
                                <div class="result-value">â‚¹{{ result.monthly_withdrawal | with_unit }}</div>
                            </div>

                            <div class="result-item swp-specific">
                                <div class="result-label">Total Withdrawn</div>
                                <div class="result-value">â‚¹{{ result.total_withdrawn | with_unit }}</div>
                            </div>

                            <div class="result-item swp-specific highlight">
                                <div class="result-label">Duration</div>
                                <div class="result-value">{{ result.duration_years }} Years</div>
                            </div>

                            <div class="result-item swp-specific">
                                <div class="result-label">Remaining Corpus</div>
                                <div class="result-value">â‚¹{{ result.remaining_corpus | with_unit }}</div>
                            </div>

                            <div class="result-item swp-specific">
                                <div class="result-label">Avg Monthly Withdrawal</div>
                                <div class="result-value">â‚¹{{ result.avg_monthly_withdrawal | with_unit }}</div>
                            </div>

                            <div class="result-item swp-specific">
                                <div class="result-label">Total Returns Earned</div>
                                <div class="result-value">â‚¹{{ result.total_returns_earned | with_unit }}</div>
                            </div>

                            {% if result.corpus_exhausted %}
                            <div class="result-item tax">
                                <div class="result-label">Status</div>
                                <div class="result-value">Corpus Exhausted</div>
                            </div>
                            {% endif %}
                        </div>

                        {% if chart %}
                        <div class="chart-container">
                            <img src="data:image/png;base64,{{ chart }}" alt="SWP Analysis Chart">
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-results">
                            <p>Enter your SWP details and click "Calculate SWP" to see the analysis.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

    <script>
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab button
            event.target.classList.add('active');
        }

        function switchCalculator(type) {
            // Update hidden input
            document.getElementById('calc-type').value = type;
            
            // Update button states
            const buttons = document.querySelectorAll('.calc-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide appropriate fields
            if (type === 'sip') {
                document.getElementById('sip-fields').style.display = 'block';
                document.getElementById('lumpsum-fields').style.display = 'none';
            } else {
                document.getElementById('sip-fields').style.display = 'none';
                document.getElementById('lumpsum-fields').style.display = 'block';
            }
        }

        function switchSimpleCalc(type) {
            // Update hidden input
            document.getElementById('simple-calc-type').value = type;
            
            // Update button states
            const buttons = document.querySelectorAll('.simple-calc-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide appropriate fields
            if (type === 'sip') {
                document.getElementById('simple-sip-fields').style.display = 'block';
                document.getElementById('simple-lumpsum-fields').style.display = 'none';
            } else {
                document.getElementById('simple-sip-fields').style.display = 'none';
                document.getElementById('simple-lumpsum-fields').style.display = 'block';
            }
        }

        function toggleAdvanced() {
            const options = document.getElementById('advanced-options');
            const arrow = document.getElementById('advanced-arrow');
            
            if (options.classList.contains('show')) {
                options.classList.remove('show');
                arrow.classList.remove('rotated');
            } else {
                options.classList.add('show');
                arrow.classList.add('rotated');
            }
        }

        // Initialize calculator on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial calculator type for advanced tab
            const calcType = document.getElementById('calc-type').value;
            if (calcType === 'lumpsum') {
                document.getElementById('sip-fields').style.display = 'none';
                document.getElementById('lumpsum-fields').style.display = 'block';
            }
            
            // Set initial calculator type for simple tab
            const simpleCalcType = document.getElementById('simple-calc-type').value;
            if (simpleCalcType === 'lumpsum') {
                document.getElementById('simple-sip-fields').style.display = 'none';
                document.getElementById('simple-lumpsum-fields').style.display = 'block';
            }
        });
    </script>
{% endblock %}
